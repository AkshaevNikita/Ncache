# Ncache - что такое и с чем едят.

NCache - key-value хранилище данных с открытым исходным кодом. Ncache является лидером распределенного кэширования для приложений .NET.

Преимущества NCache - масштабируемость и доступность.

NCache разработан на Java, C#.

[Официальный сайт NCache]

[Документация NCache]

Рейтинг key-value хранилищ по версии сайта [db-engines.com](https://db-engines.com) выгляядит следующим образом:

![alt text](https://github.com/AkshaevNikita/Ncache/blob/main/ranking.png?raw=true)



# Инструменты для взаимодействия с Ncache.

NCache доступен в версиях с Open-source, Enterprise и Community Editions, локально и в облаке, с .NET, .NET Core и Java клиентами.
Также можно развертывать Ncache в docker контейнере.

# Работа с базой данных.

NCache поддерживает SQL-подобный синтаксис запросов и LINQ  для поиска в кеше.






[Официальный сайт NCache]:https://www.alachisoft.com/
[Документация NCache]:https://www.alachisoft.com/resources/docs/#ncache

# Применение.

Существует три распространенных способа использования NCache:

- Кэширование данных приложения.

Распределенный кэш, такой как NCache, обрабатывает транзакции данных приложения в оперативной памяти и на нескольких серверах кэша, поэтому он может обрабатывать любую нагрузку с чрезвычайно высокой скоростью. База данных не может этого сделать, поэтому обработка данных приложения становится узким местом. Кроме того, кэш масштабируется под любую нагрузку, что является еще одним преимуществом использования базы данных с кэшироаванием.

- Кэширование веб-приложений ASP.NET

Вторым распространенным вариантом является использование NCache для веб-приложений ASP.NET или Java JSP. В первом случае можно кэшировать состояние сеанса как для многосайтовой конфигурации, так и для одного сайта. Многосайтовость здесь означает, что при наличии двух центров обработки данных пользователь может переходить из одного центра обработки в другой без потери сеанса; это функция, предоставляемая NCache.

Для ASP.NET вы также можете кэшировать viewstate. Viewstate - это строка, которая отправляется сервером браузеру, способная потреблять много трафика, тем самым замедляя время отклика, иногда значительно. Благодаря кэшированию на стороне сервера повышается производительность и снижаются требования к пропускной способности, что приводит к экономии средств.

Еще одна особенность в ASP.NET - это кэширование вывода страницы. При следующем вызове этой страницы вместо ее выполнения возвращается только изменение на ней.

Для веб-приложения java можно кэшировать сеансы сервлетов java или сохранять их в NCache так же, как в ASP.NET кэшировать состояние сеанса. Ни одна из этих функций не требует программирования, вы просто вносите изменения в конфигурацию, и NCache подключается автоматически.

- Общий доступ к данным выполнения.

Это третий случай использования, о котором многие люди не знают. Вы можете использовать NCache как очень мощную платформу обмена данными во время выполнения (RTDS). NCache обеспечивает управляемую событиями Pub / Sub модель совместного использования данных, которая имеет функции уведомления о событиях, а также непрерывные функции запросов. [Сайт](http://www.alachisoft.com/ncache/run-time-data-sharing.html) о возможностях NCache содержит больше подробной информации о RTDS.

# Индексация в NCache.

### Индексы поиска.
NCache предоставляет индекс поиска в кеше, чтобы ускорить выполнение запросов в кеше. Для целей поиска все, что нужно сделать, это просто проиндексировать все доступные для поиска атрибуты. NCache не будет искать неиндексированный атрибут в кеше, потому что он должен пройти через весь кеш, чтобы найти связанные данные, которые повлияют на производительность кеша.

Также индексы определяются по фактическим типам данных кэшированных элементов. Благодаря индексированию NCache знает, какие данные будут храниться, и будет хранить их в доступном для поиска виде.

NCache предоставляет два способа определения индексов.

- Pre-Defined Index (статический индекс)

Для поиска объектов пользовательского класса в кластеризованном кеше необходимо заранее определить индексы запроса для этого класса. Таким образом, кеш сохранит эти данные в форме, в которой их можно будет легко запросить. Вы можете определить индексы либо через конфигурацию, либо программно . Индексы можно настроить для открытых, частных и защищенных примитивных элементов данных.

- Runtime Index  (динамический индекс)

Если в приложении есть атрибуты, которые определены и используются во время выполнения, следует использовать индексирование во время выполнения. Например, могут быть некоторые расчетные значения, присвоенные продукту, связанные с его продажами. Когда какой-либо продукт приобретается любым покупателем, сведения о продаже сохраняются в кеше для последующего создания ежедневного отчета о тенденциях продаж с помощью кэшированных значений. Это значение определяется во время выполнения, поэтому оно является атрибутом времени выполнения продукта.

NCache автоматически создаст индексы для данных, добавляемых клиентом кэша. Это означает, что индексы не нужно настраивать перед их использованием в качестве атрибутов времени выполнения.

### Индексы выселения.

Выселение — это полезная функция NCache, когда при заполнении кэша он решает удалить существующие данные, чтобы разместить входящие данные. В этом сценарии вытеснение может сгладить операции с кэшем, сохраняя ограничение на размер кэша за счет удаления настроенного процента данных.

- Вытеснение на основе приоритета.

Для вытеснения на основе приоритета индекс сохраняется для приоритета от высокого к низкому, и когда кеш заполнен, поток вытеснения выбирает ключи из индекса с низким приоритетом и вытесняет их из кеша.

- Наименее недавно использовавшиеся (LRU)

Для наименее недавно использовавшихся (LRU) индекс вытеснения сохраняется на время использования ключей, а когда кеш заполнен, поток вытеснения выбирает ключи из индекса, которые использовались наименее недавно, и удаляет их из кеша.

- Наименее часто используемые (LFU)

Для наименее часто используемых (LFU) индекс вытеснения сохраняется для количества использованных ключей, а когда кеш заполнен, поток вытеснения выбирает ключи из индекса, которые используются реже всего, и удаляет их из кеша.

### Индексы срока действия.

Срок действия — это свойство, прикрепленное к каждому кэшируемому элементу. Это свойство прилагается к каждому объекту, так что каждый объект кэша можно оценить по его возрасту, этот возраст объекта будет определять время его истечения. Когда этот объект истечения срока действия становится недействительным, связанный с ним элемент удаляется из кэша.

NCache сохраняет DateTime индекс срока действия для ключей кэша, чтобы эффективно удалять их по истечении срока действия. Срок действия менеджера истекает после интервала очистки.

Интервал очистки — это периодический интервал, после которого элементы с истекшим сроком действия удаляются из кэша. Интервал очистки кэша можно изменить в настройках конфигурации.

По истечении интервала очистки диспетчер истечения срока действия получает ключи из индекса, а элементы с истекшим сроком действия удаляются из кеша. После удаления элементов с истекшим сроком действия из кеша поток истечения срока действия приостанавливается на «длительность интервала очистки», указанную в конфигурации кеша. NCache предоставляет два типа истечения срока действия, описанные в разделе «Стратегии инвалидации данных».

- Абсолютный срок действия
- Скользящий срок действия


[Сайт, где можно посмотреть, как создавать индексы](https://www.alachisoft.com/resources/docs/ncache/admin-guide/configure-query-index.html)

### Пример создания индексов. 

![alt text](https://github.com/AkshaevNikita/Ncache/blob/main/indexes1.png?raw=true)

![alt text](https://github.com/AkshaevNikita/Ncache/blob/main/indexes2.png?raw=true)

![alt text](https://github.com/AkshaevNikita/Ncache/blob/main/indexes3.png?raw=true)

# План запросов.
Framework, с которым взаимодействует NCache имеет следующие формы кэширования:
- Query Plan Caching — повторное использование сгенерированной команды хранилища, когда запрос выполняется более одного раза.

# Транзакции.
### Оптимистическа и писсимистическая блокировка.
NCache не поддерживает ACID, существует только следующие блокировки:

Пессимистическая блокировка схожа с принципом Мерфи. Она предполагает, что если что-то плохое может случится, это обязательно случится. В отличии от пессимистической, оптимистическая блокировка предполагает что во время обновления записи в БД мы будем единственными кто ее меняет

# Восстановление при сбоях (Split-Brain).

Split-Brain возникает, когда один или несколько узлов кластера отключаются от других узлов, что приводит к образованию подкластеров.

Когда происходит расщепление мозга, существует вероятность формирования подкластеров. Следовательно, один из подкластеров должен быть удален, чтобы обеспечить перенаправление всех клиентов на один работоспособный кластер. Поскольку удаление подкластера означает, что данные будут потеряны, удаляемый подкластер выбирается по следующим критериям:

- Если подкластеры имеют разный размер, будет удален подкластер с наименьшим количеством узлов. Это необходимо для обеспечения минимальной потери данных, поскольку меньший кластер будет содержать меньше данных.
- Если размер кластеров одинаковый, субкластер, узел координатора которого имеет более высокий IP-адрес, будет удален. Например, IP-адреса узлов-координаторов подкластеров A и B равны 20.200.20.38 и 20.200.20.40 соответственно. В этом случае подкластер с IP-адресом узла-координатора 20.200.20.40 будет удален.

Split-Brain может отображать несогласованность данных или проблемы с доступностью, возникающие из-за обслуживания двух отдельных наборов данных с перекрывающейся областью действия. Кроме того, это также может привести к серьезным проблемам и создать ужасную ситуацию для администратора. По этой причине очень важно убедиться, что нет риска Split-Brain и повреждения данных.

Существует несколько общих подходов к решению проблемы с сетевым разделом после возникновения Split-Brain.

- Оптимистичный подход
- Пессимистический подход

При оптимистическом подходе канал связи между узлами просто восстанавливается, а разделенные узлы временно работают как обычно. Это делается при условии, что узлы автоматически синхронизируются за короткое время. Такой подход может быть просто легким выходом, так как всегда существует угроза повреждения данных в случае Split-Brain.

С другой стороны, пессимистический подход требует отказаться от доступности систем или просто пожертвовать ими, чтобы обеспечить согласованность данных. При обнаружении сетевого раздела доступ к подразделам ограничивается. Это делается для обеспечения согласованности данных. В этом случае, чтобы обойти расхождение истории, только один компонент может продолжать делать запросы на чтение/запись к хранилищу.

Подробнее об этом пожно прочитать [здесь](https://www.alachisoft.com/resources/docs/ncache/admin-guide/split-brain.html)

### Термины Data Mining, Data Warehousing и OLAP не имеют место в NCache.

# Безопасность и шифрование данных NCache.

NCache предоставляет мощные функции безопасности и шифрования, которые помогают защитить кэш от несанкционированного доступа. Это также гарантирует, что конфиденциальные данные вашего приложения защищены как в хранилище кеша, так и во время передачи по сети между вашим приложением и серверами кеша. И вы можете сделать все это без каких-либо изменений кода.

Вот некоторые из способов, которыми NCache обеспечивает безопасность вашего кэша:
- [Защищенные соединения SSL/TLS](https://www.alachisoft.com/ncache/security-encryption-features.html#secured-ssl-tls-connections)
- [Шифрование данных кэш-клиентом](https://www.alachisoft.com/ncache/security-encryption-features.html#data-encryption-by-cache-clients)
- [Безопасность кэша: аутентификация и авторизация](https://www.alachisoft.com/ncache/security-encryption-features.html#cache-security-authentication)

### Защищенные подключения к кешу через SSL/TLS.

NCache поддерживает «без изменения кода», мощные функции безопасности для защиты ваших данных и передачи по сети от несанкционированного доступа.

Опционально включенное шифрование Transport Layer Security/Secure Socket Layer (TLS/SSL) обеспечивает безопасный обмен данными между сервером кэша NCache и авторизованным клиентом(ами) кэша. Пользователи могут включить любой выданный или самозаверяющий сертификат SSL для соединений с клиентом(ами) или могут включить соединения компонент-компонент в NCache. Это гарантирует зашифрованную передачу данных , которая отделена от защищенных данных TLS.

NCache поддерживает безопасную (с шифрованием и проверкой подлинности) связь клиент-сервер с использованием протокола безопасности TLS 1.2. Это тот же протокол, который используется для связи HTTP.

Чтобы создать сертификат TLS (или SSL для более ранних версий NCache), следуйте документации по настройке шифрования SSL/TLS в NCache .

### Шифрование данных кэш-клиентом.

Если ваше приложение имеет дело с конфиденциальными и важными данными, которые вы хотите защитить, и вы используете распределенный кэш в памяти , вам необходимо убедиться, что ваш распределенный кэш защищает эти конфиденциальные данные от нежелательного доступа с помощью шифрования.

NCache предоставляет богатый набор алгоритмов шифрования.

Шифрование и дешифрование данных NCache происходит внутри процесса клиентского приложения NCache. Следовательно, все данные, передаваемые по сети между вашим приложением и кластером кеша, уже зашифрованы. Точно так же в хранилище кеша хранятся только зашифрованные данные. Вы предоставляете ключ шифрования, используемый NCache, который хранится в файлах конфигурации безопасности NCache на каждом сервере кэширования в зашифрованном виде. Ключ шифрования автоматически отправляется клиентам для использования в памяти после успешного подключения.

Вы можете включить шифрование через веб-менеджер NCache без каких-либо усилий по программированию с вашей стороны. После включения шифрования клиент NCache автоматически начинает шифровать ваши объекты перед их отправкой в ​​кластер кэша. Кроме того, он автоматически расшифровывает объекты, извлеченные из кеша, перед их доставкой вашему приложению.

### Безопасность кэша: аутентификация и авторизация


NCache обеспечивает безопасность благодаря встроенной в продукт аутентификации и авторизации. NCache классифицирует пользователей на основе двух разных уровней безопасности следующим образом:

- Пользователь для защиты кэша: этим пользователям разрешено выполнять операции на уровне кэша . Этот «пользователь» определяется на уровне кеша и заполняется в файле конфигурации кеша .
- Пользователь для Node Security: этим пользователям разрешено выполнять любые операции, связанные с управлением и настройкой, на узле кластера. Этот «пользователь» определяется на уровне кэш-сервера и заполняется в файле конфигурации безопасности.

![alt text](https://github.com/AkshaevNikita/Ncache/blob/main/security.png?raw=true)

##### Авторизация.

После успешной проверки подлинности подключения к кэшу NCache проверяет файлы конфигурации NCache на сервере кэша, чтобы авторизовать это подключение. Как только соединение аутентифицировано в активном каталоге, оно авторизуется либо из config.ncconf , либо из security.ncconf на основе уровня безопасности на уровне кэша или узла соответственно.

Вы можете указать информацию об авторизации с помощью инструментов управления NCache во время включения безопасности. Затем вы можете добавить дополнительных «пользователей» или «администраторов» к авторизации безопасности по мере необходимости.

# Авторы NCache.

NCache разрабатывает компания Alachisoft, коммиты могут оставлять [тут](https://github.com/Alachisoft/NCache) 12 человек, большинство которых из Индии.

### Sample data

Образцы демобазы можно найти по [ссылке](https://www.alachisoft.com/resources/samples/)

# Где можно пройти обучение?

Обучение можно пройти на [Ютуб-канале](https://www.youtube.com/c/NCache/featured), здесь же можно следить за обновлениями и т.д.

Также у NCache очень удобная [документация](https://www.alachisoft.com/resources/docs/), написанная простым языком.
