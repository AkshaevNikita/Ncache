# Ncache - что такое и с чем едят.

NCache - key-value хранилище данных с открытым исходным кодом. Ncache является лидером распределенного кэширования для приложений .NET.

Преимущества NCache - масштабируемость и доступность.

NCache разработан на Java, C#.

[Официальный сайт NCache]

[Документация NCache]

Рейтинг key-value хранилищ по версии сайта [db-engines.com](https://db-engines.com) выгляядит следующим образом:

![alt text](https://github.com/AkshaevNikita/Ncache/blob/main/ranking.png?raw=true)



# Инструменты для взаимодействия с Ncache.

NCache доступен в версиях с Open-source, Enterprise и Community Editions, локально и в облаке, с .NET, .NET Core и Java клиентами.
Также можно развертывать Ncache в docker контейнере.

# Работа с базой данных.

NCache поддерживает SQL-подобный синтаксис запросов и LINQ  для поиска в кеше.






[Официальный сайт NCache]:https://www.alachisoft.com/
[Документация NCache]:https://www.alachisoft.com/resources/docs/#ncache

# Применение.

Существует три распространенных способа использования NCache:

- Кэширование данных приложения.

Распределенный кэш, такой как NCache, обрабатывает транзакции данных приложения в оперативной памяти и на нескольких серверах кэша, поэтому он может обрабатывать любую нагрузку с чрезвычайно высокой скоростью. База данных не может этого сделать, поэтому обработка данных приложения становится узким местом. Кроме того, кэш масштабируется под любую нагрузку, что является еще одним преимуществом использования базы данных с кэшироаванием.

- Кэширование веб-приложений ASP.NET

Вторым распространенным вариантом является использование NCache для веб-приложений ASP.NET или Java JSP. В первом случае можно кэшировать состояние сеанса как для многосайтовой конфигурации, так и для одного сайта. Многосайтовость здесь означает, что при наличии двух центров обработки данных пользователь может переходить из одного центра обработки в другой без потери сеанса; это функция, предоставляемая NCache.

Для ASP.NET вы также можете кэшировать viewstate. Viewstate - это строка, которая отправляется сервером браузеру, способная потреблять много трафика, тем самым замедляя время отклика, иногда значительно. Благодаря кэшированию на стороне сервера повышается производительность и снижаются требования к пропускной способности, что приводит к экономии средств.

Еще одна особенность в ASP.NET - это кэширование вывода страницы. При следующем вызове этой страницы вместо ее выполнения возвращается только изменение на ней.

Для веб-приложения java можно кэшировать сеансы сервлетов java или сохранять их в NCache так же, как в ASP.NET кэшировать состояние сеанса. Ни одна из этих функций не требует программирования, вы просто вносите изменения в конфигурацию, и NCache подключается автоматически.

- Общий доступ к данным выполнения.

Это третий случай использования, о котором многие люди не знают. Вы можете использовать NCache как очень мощную платформу обмена данными во время выполнения (RTDS). NCache обеспечивает управляемую событиями Pub / Sub модель совместного использования данных, которая имеет функции уведомления о событиях, а также непрерывные функции запросов. [Сайт](http://www.alachisoft.com/ncache/run-time-data-sharing.html) о возможностях NCache содержит больше подробной информации о RTDS.

# Индексация в NCache.

### Индексы поиска.
NCache предоставляет индекс поиска в кеше, чтобы ускорить выполнение запросов в кеше. Для целей поиска все, что нужно сделать, это просто проиндексировать все доступные для поиска атрибуты. NCache не будет искать неиндексированный атрибут в кеше, потому что он должен пройти через весь кеш, чтобы найти связанные данные, которые повлияют на производительность кеша.

Также индексы определяются по фактическим типам данных кэшированных элементов. Благодаря индексированию NCache знает, какие данные будут храниться, и будет хранить их в доступном для поиска виде.

NCache предоставляет два способа определения индексов.

- Pre-Defined Index (статический индекс)

Для поиска объектов пользовательского класса в кластеризованном кеше необходимо заранее определить индексы запроса для этого класса. Таким образом, кеш сохранит эти данные в форме, в которой их можно будет легко запросить. Вы можете определить индексы либо через конфигурацию, либо программно . Индексы можно настроить для открытых, частных и защищенных примитивных элементов данных.

- Runtime Index  (динамический индекс)

Если в приложении есть атрибуты, которые определены и используются во время выполнения, следует использовать индексирование во время выполнения. Например, могут быть некоторые расчетные значения, присвоенные продукту, связанные с его продажами. Когда какой-либо продукт приобретается любым покупателем, сведения о продаже сохраняются в кеше для последующего создания ежедневного отчета о тенденциях продаж с помощью кэшированных значений. Это значение определяется во время выполнения, поэтому оно является атрибутом времени выполнения продукта.

NCache автоматически создаст индексы для данных, добавляемых клиентом кэша. Это означает, что индексы не нужно настраивать перед их использованием в качестве атрибутов времени выполнения.

### Индексы выселения.

Выселение — это полезная функция NCache, когда при заполнении кэша он решает удалить существующие данные, чтобы разместить входящие данные. В этом сценарии вытеснение может сгладить операции с кэшем, сохраняя ограничение на размер кэша за счет удаления настроенного процента данных.

- Вытеснение на основе приоритета.

Для вытеснения на основе приоритета индекс сохраняется для приоритета от высокого к низкому, и когда кеш заполнен, поток вытеснения выбирает ключи из индекса с низким приоритетом и вытесняет их из кеша.

- Наименее недавно использовавшиеся (LRU)

Для наименее недавно использовавшихся (LRU) индекс вытеснения сохраняется на время использования ключей, а когда кеш заполнен, поток вытеснения выбирает ключи из индекса, которые использовались наименее недавно, и удаляет их из кеша.

- Наименее часто используемые (LFU)

Для наименее часто используемых (LFU) индекс вытеснения сохраняется для количества использованных ключей, а когда кеш заполнен, поток вытеснения выбирает ключи из индекса, которые используются реже всего, и удаляет их из кеша.

### Индексы срока действия.

Срок действия — это свойство, прикрепленное к каждому кэшируемому элементу. Это свойство прилагается к каждому объекту, так что каждый объект кэша можно оценить по его возрасту, этот возраст объекта будет определять время его истечения. Когда этот объект истечения срока действия становится недействительным, связанный с ним элемент удаляется из кэша.

NCache сохраняет DateTime индекс срока действия для ключей кэша, чтобы эффективно удалять их по истечении срока действия. Срок действия менеджера истекает после интервала очистки.

Интервал очистки — это периодический интервал, после которого элементы с истекшим сроком действия удаляются из кэша. Интервал очистки кэша можно изменить в настройках конфигурации.

По истечении интервала очистки диспетчер истечения срока действия получает ключи из индекса, а элементы с истекшим сроком действия удаляются из кеша. После удаления элементов с истекшим сроком действия из кеша поток истечения срока действия приостанавливается на «длительность интервала очистки», указанную в конфигурации кеша. NCache предоставляет два типа истечения срока действия, описанные в разделе «Стратегии инвалидации данных».

- Абсолютный срок действия
- Скользящий срок действия


[Сайт, где можно посмотреть, как создавать индексы](https://www.alachisoft.com/resources/docs/ncache/admin-guide/configure-query-index.html)

### Пример создания индексов. 

![alt text](https://github.com/AkshaevNikita/Ncache/blob/main/indexes1.png?raw=true)

![alt text](https://github.com/AkshaevNikita/Ncache/blob/main/indexes2.png?raw=true)

![alt text](https://github.com/AkshaevNikita/Ncache/blob/main/indexes3.png?raw=true)

# План запросов.
Framework, с которым взаимодействует NCache имеет следующие формы кэширования:
- Query Plan Caching — повторное использование сгенерированной команды хранилища, когда запрос выполняется более одного раза.

# Транзакции.
### Оптимистическа и писсимистическая блокировка.

Пессимистическая блокировка схожа с принципом Мерфи. Она предполагает, что если что-то плохое может случится, это обязательно случится. В отличии от пессимистической, оптимистическая блокировка предполагает что во время обновления записи в БД мы будем единственными кто ее меняет


